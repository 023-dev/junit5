apply plugin: 'jacoco'
apply plugin: 'org.junit.gen5.gradle'

jar.enabled = false
javadoc.enabled = false
javadocJar.enabled = false
sourcesJar.enabled = false
uploadArchives.enabled = false

junit5 {
	// version '5.0.0-SNAPSHOT' // not needed since all dependencies are declared explicitly
	runJunit4 true
	matchClassName '.*Tests?'
	logManager 'org.apache.logging.log4j.jul.LogManager'
	// includeTag 'fast'
	// excludeTag 'slow'
}

def testedProjects = [
	project(':junit-commons'),
	project(':junit-console'),
	project(':junit-engine-api'),
	project(':junit-launcher'),
	project(':junit4-engine'),
	project(':junit4-runner'),
	project(':junit5-api'),
	project(':junit5-engine')
]

dependencies {
	testedProjects.each { project ->
		testCompile(project)
	}

	testCompile("org.assertj:assertj-core:${assertJVersion}")
	testCompile("org.mockito:mockito-core:${mockitoVersion}")

	testRuntime("org.apache.logging.log4j:log4j-core:${log4JVersion}")
	testRuntime("org.apache.logging.log4j:log4j-jul:${log4JVersion}")
}

// The JUnit5Plugin registers the junit5Test task *after* the project has
// been evaluated. We can therefore only configure the junit5Test task
// once it actually exists.
afterEvaluate {

	jacoco {
		toolVersion = '0.7.4.201502262128'
		applyTo junit5Test
	}

	task junit5CodeCoverageReport(type:JacocoReport){
		executionData junit5Test
		sourceSets sourceSets.main
		sourceDirectories = files()
		classDirectories = files()
		testedProjects.each { project ->
			sourceDirectories = files(sourceDirectories, project.sourceSets.main.allSource.srcDirs)
			classDirectories = files(classDirectories, project.sourceSets.main.output)
		}
		reports {
			xml.enabled = true
			html.enabled = true
		}
	}

}
